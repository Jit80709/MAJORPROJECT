<% layout("/layouts/boilerplate") -%>

<div class="container mt-5">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
      <div class="list-group shadow-sm">
        <a class="list-group-item list-group-item-action" href="#listings" onclick="showSection('listingsSection')">
          <i class="fa-solid fa-house-user me-2"></i> My Listings
        </a>
        <a class="list-group-item list-group-item-action" href="#bookings" onclick="showSection('bookingsSection')">
          <i class="fa-solid fa-calendar-check me-2"></i> My Bookings
        </a>
        <a class="list-group-item list-group-item-action" href="#wishlist" onclick="showSection('wishlistSection')">
          <i class="fa-solid fa-heart me-2"></i> My Wishlist
        </a>
        <a class="list-group-item list-group-item-action text-danger" href="/logout">
          <i class="fa-solid fa-right-from-bracket me-2"></i> Logout
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9">

      <h2>Welcome, <%= currUser.username %> </h2>
      <hr/>

      <!-- Listings Section -->
      <div id="listingsSection" class="dashboard-section">
        <h3>üìù My Listings</h3>
        <% if (myListings.length === 0) { %>
          <p>You haven't created any listings yet.</p>
        <% } else { %>
          <div class="row">
            <% myListings.forEach(listing => { %>
              <div class="col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                  <img src="<%= listing.image.url %>" class="card-img-top" alt="Listing image">
                  <div class="card-body">
                    <h5 class="card-title"><%= listing.title %></h5>
                    <a href="/listings/<%= listing._id %>" class="btn btn-sm btn-outline-primary">View</a>
                  </div>
                </div>
              </div>
            <% }) %>
          </div>
        <% } %>
      </div>

      <!-- Bookings Section -->
      <div id="bookingsSection" class="dashboard-section" style="display:none;">
        <h3>üìÖ My Bookings</h3>
        <% if (myBookings.length === 0) { %>
          <p>You haven‚Äôt booked any listings.</p>
        <% } else { %>
          <ul class="list-group">
            <% myBookings.forEach(booking => { %>
              <li class="list-group-item">
                <strong><%= booking.listing ? booking.listing.title : "Listing Not Available" %></strong> ‚Äî 
                From <%= booking.checkIn ? booking.checkIn.toDateString() : "Unknown" %> 
                to <%= booking.checkOut ? booking.checkOut.toDateString() : "Unknown" %>

                <form action="/bookings/<%= booking._id %>/cancel?_method=DELETE" method="POST">
                  <button class="btn btn-danger btn-sm">Cancel</button>
                </form>

              </li>
            <% }) %>
          </ul>
        <% } %>
      </div>

      <!-- Wishlist Section -->
      <div id="wishlistSection" class="dashboard-section" style="display:none;">
        <h3>‚ù§Ô∏è My Wishlist</h3>
        <% if (wishlist.length === 0) { %>
          <p>No listings in wishlist.</p>
        <% } else { %>
          <div class="row">
            <% wishlist.forEach(listing => { %>
              <div class="col-md-6 mb-4">
                <div class="card h-100 shadow-sm">
                  <img src="<%= listing.image.url %>" class="card-img-top" alt="Wishlist image">
                  <div class="card-body">
                    <h6 class="card-title"><%= listing.title %></h6>
                    <a href="/listings/<%= listing._id %>" class="btn btn-sm btn-outline-dark">View</a>
                    <form action="/wishlist/<%= listing._id %>/remove" method="POST" class="d-inline">
                      <button class="btn btn-sm btn-outline-danger">Remove</button>
                    </form>
                  </div>
                </div>
              </div>
            <% }) %>
          </div>
        <% } %>
      </div>

    </div>
  </div>
</div>

<!-- Section Switch Script -->
<script>
  function showSection(sectionId) {
    const sections = document.querySelectorAll('.dashboard-section');
    sections.forEach(sec => sec.style.display = 'none');
    document.getElementById(sectionId).style.display = 'block';
  }

  // Optional: Show section based on URL hash
  const hash = window.location.hash.replace('#', '');
  if (hash) {
    showSection(hash + 'Section');
  } else {
    showSection('listingsSection');
  }
</script>




<style>
  body {
    background-color: #f9f9f9;
  }

  .dashboard-section {
    animation: fadeIn 0.4s ease-in;
  }

  .list-group-item {
    border-radius: 8px;
    transition: all 0.2s ease-in-out;
  }

  .list-group-item:hover {
    background-color: #f8f9fa;
    transform: scale(1.01);
  }

  .list-group-item-action.text-danger:hover {
    background-color: #ffe6e6;
  }

  .card {
    border: none;
    border-radius: 15px;
    overflow: hidden;
    transition: box-shadow 0.3s ease-in-out;
  }

  .card:hover {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .card-img-top {
    height: 200px;
    object-fit: cover;
  }

  .card-title {
    font-size: 1.1rem;
    font-weight: 600;
  }

  .btn-outline-primary,
  .btn-outline-dark,
  .btn-outline-danger {
    border-radius: 20px;
  }

  h2, h3 {
    font-weight: bold;
    color: #333;
  }

  /* Smooth Fade Animation */
  /*@keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }*/
</style>

